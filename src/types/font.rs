use std::collections::HashMap;
use crate::traits::FontType;

const MAPPED_SCREEN_WIDTH: f32 = 499.0; // mappings performed on an A4 page with 1/2 inch margins
const MAPPED_FONT_SIZE: f32 = 18.0;     // font size used during mapping

/// Times Roman is provided in the library. Additional fonts can be registered using `.register` method on the `Doc` struct.
/// 
/// # Required character maps:
/// - Normal
/// - Bold
/// - Italic
/// - Bold Italic


#[derive(Debug)]
pub struct Font {
    normal: HashMap<char,f32>,
    bold: HashMap<char,f32>,
    italic: HashMap<char,f32>,
    bold_italic: HashMap<char,f32>,
}

impl FontType for Font {
    fn normal(&self, ch: &char, font_size: f32) -> f32 {
        self.normal.get(ch)
            .map(|width| Font::standardize(*width, font_size))
            .unwrap_or_else(|| Font::standardize(55.0, font_size))
    }

    fn bold(&self, ch: &char, font_size: f32) -> f32 {
        self.bold.get(ch)
            .map(|width| Font::standardize(*width, font_size))
            .unwrap_or_else(|| Font::standardize(55.0, font_size))
    }

    fn italic(&self, ch: &char, font_size: f32) -> f32 {
        self.italic.get(ch)
            .map(|width| Font::standardize(*width, font_size))
            .unwrap_or_else(|| Font::standardize(55.0, font_size))
    }

    fn bold_italic(&self, ch: &char, font_size: f32) -> f32 {
        self.bold_italic.get(ch)
            .map(|width| Font::standardize(*width, font_size))
            .unwrap_or_else(|| Font::standardize(55.0, font_size))
    }

    // The original map was based on a font size of 18.0. This method returns a standard width,
    // for any given font size, equal to the number of characters that would fit on an A4 page.
    fn standardize(width: f32, font_size: f32) -> f32 {
        let modifier: f32 = font_size / MAPPED_FONT_SIZE ;
        MAPPED_SCREEN_WIDTH / width * modifier
    }

    fn new() -> Self {
        let normal: HashMap<char,f32> = HashMap::from([
            ('a', 62.5),
            ('b', 55.6),
            ('c', 62.6),
            ('d', 55.6),
            ('e', 62.5),
            ('f', 83.2),
            ('g', 55.6),
            ('h', 55.6),
            ('i', 99.75),
            ('j', 100.0),
            ('k', 55.75),
            ('l', 99.6),
            ('m', 35.75),
            ('n', 55.6),
            ('o', 55.6),
            ('p', 55.6),
            ('q', 55.6),
            ('r', 83.0),
            ('s', 71.2),
            ('t', 99.2),
            ('u', 55.6),
            ('v', 55.6),
            ('w', 38.6),
            ('x', 55.6),
            ('y', 55.6),
            ('z', 62.0),
            ('0', 55.0),
            ('1', 55.0),
            ('2', 55.0),
            ('3', 55.0),
            ('4', 55.0),
            ('5', 55.0),
            ('6', 55.0),
            ('7', 55.0),
            ('8', 55.0),
            ('9', 55.0),
            ('A', 38.5),
            ('B', 41.5),
            ('C', 41.5),
            ('D', 38.5),
            ('E', 45.5),
            ('F', 50.0),
            ('G', 38.5),
            ('H', 38.5),
            ('I', 83.2),
            ('J', 71.2),
            ('K', 38.5),
            ('L', 45.5),
            ('M', 31.5),
            ('N', 38.5),
            ('O', 38.5),
            ('P', 50.0),
            ('Q', 38.5),
            ('R', 41.5),
            ('S', 50.0),
            ('T', 45.5),
            ('U', 38.5),
            ('V', 38.5),
            ('W', 29.5),
            ('X', 38.5),
            ('Y', 38.5),
            ('Z', 45.4),
            (';', 100.0),
            (':', 100.0),
            ('!', 83.0),
            ('#', 55.5),
            ('@', 30.0),
            ('$', 55.5),
            ('(', 83.0),
            (')', 83.0),
            ('*', 55.5),
            ('&', 35.5),
            ('-', 83.5),
            ('_', 55.5),
            ('\\', 99.5),
            ('/', 99.5),
            ('~', 51.5),
            ('"', 68.5),
            ('\'', 83.5),
            (',', 111.0),
            ('?', 62.0),
            ('[', 83.5),
            (']', 83.5),
            ('{', 58.0),
            ('}', 58.0),
            ('>', 49.0),
            ('<', 49.0),
            ('%', 33.5),
            ('^', 59.5),
            ('.', 111.0),
            ('`', 83.5),
            ('|', 138.5),
            (' ', 110.5),
             ('+', 73.5),
            ('=', 73.5),
        ]);
        let bold: HashMap<char,f32> = HashMap::from([
            ('a', 55.5),
            ('b', 50.0),
            ('c', 62.0),
            ('d', 49.0),
            ('e', 62.5),
            ('f', 83.0),
            ('g', 55.0),
            ('h', 49.5),
            ('i', 99.5),
            ('j', 83.0),
            ('k', 49.5),
            ('l', 99.5),
            ('m', 33.5),
            ('n', 49.5),
            ('o', 55.5),
            ('p', 50.0),
            ('q', 49.5),
            ('r', 62.5),
            ('s', 71.5),
            ('t', 83.5),
            ('u', 49.5),
            ('v', 55.5),
            ('w', 38.5),
            ('x', 55.5),
            ('y', 55.5),
            ('z', 62.0),
            ('0', 55.5),
            ('1', 55.5),
            ('2', 55.5),
            ('3', 55.5),
            ('4', 55.5),
            ('5', 55.5),
            ('6', 55.5),
            ('7', 55.5),
            ('8', 55.5),
            ('9', 55.5),
            ('A', 38.5),
            ('B', 41.5),
            ('C', 38.4),
            ('D', 38.5),
            ('E', 41.5),
            ('F', 45.0),
            ('G', 35.75),
            ('H', 35.75),
            ('I', 71.25),
            ('J', 55.25),
            ('K', 35.75),
            ('L', 41.5),
            ('M', 29.5),
            ('N', 38.5),
            ('O', 35.75),
            ('P', 45.5),
            ('Q', 35.75),
            ('R', 38.5),
            ('S', 49.5),
            ('T', 41.5),
            ('U', 38.5),
            ('V', 38.5),
            ('W', 27.75),
            ('X', 38.5),
            ('Y', 38.5),
            ('Z', 41.5),
            (';', 83.5),
            (':', 83.5),
            ('!', 83.0),
            ('#', 55.5),
            ('@', 30.0),
            ('$', 55.5),
            ('(', 83.0),
            (')', 83.0),
            ('*', 55.5),
            ('&', 33.5),
            ('-', 83.5),
            ('_', 55.5),
            ('\\', 99.5),
            ('/', 99.5),
            ('~', 51.5),
            ('"', 68.5),
            ('\'', 83.5),
            (',', 111.0),
            ('?', 55.5),
            ('[', 83.5),
            (']', 83.5),
            ('{', 70.5),
            ('}', 70.5),
            ('>', 49.0),
            ('<', 49.0),
            ('%', 27.8),
            ('^', 47.75),
            ('.', 111.0),
            ('`', 83.5),
            ('|', 126.0),
            (' ', 110.5),
            ('+', 73.5),
            ('=', 73.5),
        ]);
        let italic: HashMap<char,f32> = HashMap::from([
            ('a', 55.75),
            ('b', 55.75),
            ('c', 62.5),
            ('d', 55.75),
            ('e', 62.5),
            ('f', 99.5),
            ('g', 55.5),
            ('h', 55.75),
            ('i', 99.5),
            ('j', 99.5),
            ('k', 62.5),
            ('l', 99.5),
            ('m', 38.5),
            ('n', 55.5),
            ('o', 55.5),
            ('p', 55.5),
            ('q', 55.5),
            ('r', 71.5),
            ('s', 71.5),
            ('t', 100.0),
            ('u', 55.75),
            ('v', 62.5),
            ('w', 41.5),
            ('x', 62.5),
            ('y', 62.5),
            ('z', 71.5),
            ('0', 55.5),
            ('1', 55.5),
            ('2', 55.5),
            ('3', 55.5),
            ('4', 55.5),
            ('5', 55.5),
            ('6', 55.5),
            ('7', 55.5),
            ('8', 55.5),
            ('9', 55.5),
            ('A', 45.5),
            ('B', 45.5),
            ('C', 41.5),
            ('D', 38.5),
            ('E', 45.5),
            ('F', 45.5),
            ('G', 38.5),
            ('H', 38.5),
            ('I', 83.25),
            ('J', 62.5),
            ('K', 41.5),
            ('L', 50.0),
            ('M', 33.5),
            ('N', 41.5),
            ('O', 38.25),
            ('P', 45.50),
            ('Q', 38.25),
            ('R', 45.5),
            ('S', 55.5),
            ('T', 50.0),
            ('U', 38.5),
            ('V', 45.5),
            ('W', 33.5),
            ('X', 45.5),
            ('Y', 50.0),
            ('Z', 50.0),
            (';', 83.5),
            (':', 83.5),
            ('!', 71.5),
            ('#', 55.5),
            ('@', 30.5),
            ('$', 55.5),
            ('(', 83.0),
            (')', 83.0),
            ('*', 55.5),
            ('&', 35.5),
            ('-', 83.5),
            ('_', 55.5),
            ('\\', 99.5),
            ('/', 99.5),
            ('~', 51.5),
            ('"', 68.5),
            ('\'', 83.5),
            (',', 111.0),
            ('?', 55.5),
            ('[', 71.5),
            (']', 71.5),
            ('{', 69.5),
            ('}', 69.5),
            ('>', 41.0),
            ('<', 41.0),
            ('%', 33.5),
            ('^', 65.5),
            ('.', 111.0),
            ('`', 83.5),
            ('|', 102.0),
            (' ', 110.5),
            ('+', 41.0),
            ('=', 41.0),
        ]);
        let bold_italic: HashMap<char,f32> = HashMap::from([
            ('a', 55.5),
            ('b', 55.5),
            ('c', 62.5),
            ('d', 55.5),
            ('e', 62.5),
            ('f', 83.0),
            ('g', 55.5),
            ('h', 50.0),
            ('i', 99.5),
            ('j', 99.5),
            ('k', 55.5),
            ('l', 99.5),
            ('m', 35.75),
            ('n', 50.0),
            ('o', 55.5),
            ('p', 55.75),
            ('q', 55.75),
            ('r', 71.5),
            ('s', 71.5),
            ('t', 99.5),
            ('u', 50.0),
            ('v', 62.5),
            ('w', 41.5),
            ('x', 55.5),
            ('y', 62.5),
            ('z', 71.5),
            ('0', 55.5),
            ('1', 55.5),
            ('2', 55.5),
            ('3', 55.5),
            ('4', 55.5),
            ('5', 55.5),
            ('6', 55.5),
            ('7', 55.5),
            ('8', 55.5),
            ('9', 55.5),
            ('A', 41.5),
            ('B', 41.5),
            ('C', 41.5),
            ('D', 38.5),
            ('E', 41.5),
            ('F', 41.5),
            ('G', 38.5),
            ('H', 35.75),
            ('I', 71.5),
            ('J', 55.5),
            ('K', 41.5),
            ('L', 45.4),
            ('M', 31.5),
            ('N', 38.5),
            ('O', 38.5),
            ('P', 45.5),
            ('Q', 38.5),
            ('R', 41.5),
            ('S', 50.0),
            ('T', 45.5),
            ('U', 38.5),
            ('V', 41.5),
            ('W', 31.5),
            ('X', 41.5),
            ('Y', 45.5),
            ('Z', 45.5),
            (';', 83.5),
            (':', 83.5),
            ('!', 71.5),
            ('#', 55.5),
            ('@', 33.5),
            ('$', 55.5),
            ('(', 83.0),
            (')', 83.0),
            ('*', 55.5),
            ('&', 35.5),
            ('-', 83.5),
            ('_', 55.5),
            ('\\', 99.5),
            ('/', 99.5),
            ('~', 51.5),
            ('"', 68.5),
            ('\'', 83.5),
            (',', 111.0),
            ('?', 55.5),
            ('[', 83.5),
            (']', 83.5),
            ('{', 79.5),
            ('}', 79.5),
            ('>', 49.0),
            ('<', 49.0),
            ('%', 33.5),
            ('^', 48.5),
            ('.', 111.0),
            ('`', 83.5),
            ('|', 126.0),
            (' ', 110.5),
            ('+', 48.5),
            ('=', 45.5),
        ]);

        Self { normal, bold, italic, bold_italic }
    }
}

